<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tennis | MarketMatrix</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container">
        <!-- LEFT COLUMN: API LOADER & INPUTS -->
        <div class="sidebar-column">
            <!-- CONTROLS -->
            <a href="index.html"
                style="display: block; width: 100%; padding: 10px; background: #3b82f6; color: white; text-align: center; border-radius: 6px; text-decoration: none; font-weight: 600; margin-bottom: 10px;">
                &larr; Home
            </a>
            <button id="toggleAllBtn" onclick="toggleAllCards()" style="margin-top: 0; margin-bottom: 20px;">Collapse
                All</button>

            <!-- API MATCH LOADER -->
            <div class="card" id="apiMatchLoader" style="margin-bottom: 20px;">
                <div class="card-header" onclick="toggleCard('apiMatchLoader')">
                    <h2>0. Select Match</h2>
                </div>
                <div class="card-content">
                    <div style="display: flex; flex-direction: column; gap: 12px;">
                        <div>
                            <label
                                style="font-size: 0.7rem; color: #64748b; font-weight: 600; display: block; margin-bottom: 4px;">TOURNAMENT</label>
                            <select id="tournamentSelect"
                                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: #0f172a; color: white;">
                                <option value="">Loading...</option>
                            </select>
                        </div>
                        <div>
                            <label
                                style="font-size: 0.7rem; color: #64748b; font-weight: 600; display: block; margin-bottom: 4px;">MATCH</label>
                            <select id="matchSelect"
                                style="width: 100%; padding: 8px; border: 1px solid var(--border); border-radius: 6px; background: #334155; color: white;"
                                disabled>
                                <option value="">Select tournament</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>

            <!-- INPUT ODDS -->
            <div class="card" id="inputCard">
                <div class="card-header" onclick="toggleCard('inputCard')">
                    <h2>1. Input Market Odds</h2>
                </div>
                <div class="card-content">
                    <h3>Match Winner <span id="moneylineMargin"
                            style="float: right; font-size: 0.8rem; font-weight: normal; color: #64748b;">Margin:
                            -</span></h3>
                    <div class="input-group">
                        <label>Player 1</label>
                        <input type="number" id="player1Odds" step="0.01" placeholder="1.65" oninput="runModel()">
                    </div>
                    <div class="input-group">
                        <label>Player 2</label>
                        <input type="number" id="player2Odds" step="0.01" placeholder="2.25" oninput="runModel()">
                    </div>

                    <h3 style="margin-top: 20px;">Total Games</h3>
                    <div class="input-group">
                        <label>Line</label>
                        <input type="number" id="totalGamesLine" step="0.5" placeholder="22.5" oninput="runModel()">
                    </div>

                    <div style="margin-top: 20px; padding: 12px; background: rgba(59, 130, 246, 0.1); border-radius: 6px; border: 1px solid rgba(59, 130, 246, 0.3);">
                        <p style="font-size: 0.85rem; color: #94a3b8; margin: 0;">
                            ðŸ’¡ The model uses these two inputs to calculate serve hold percentages, then derives all other markets.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- COLUMN 2: MARKETS -->
        <div class="main-content">
            <!-- CALIBRATED PARAMETERS -->
            <div class="card hidden" id="parametersArea">
                <div class="card-header" onclick="toggleCard('parametersArea')">
                    <h2>2. Calibrated Parameters</h2>
                </div>
                <div class="card-content">
                    <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 15px;">
                        Serve hold percentages calculated from market odds via Monte Carlo simulation
                    </p>
                    <div class="stat-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="stat-box">
                            <div class="stat-val" id="p1HoldRate" style="color: #3b82f6; font-size: 2rem;">-</div>
                            <div class="stat-label">Player 1 Hold %</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="p2HoldRate" style="color: #8b5cf6; font-size: 2rem;">-</div>
                            <div class="stat-label">Player 2 Hold %</div>
                        </div>
                    </div>
                    <div class="stat-grid" style="grid-template-columns: repeat(2, 1fr); margin-top: 15px;">
                        <div class="stat-box">
                            <div class="stat-val" id="simWinProb" style="font-size: 1.3rem;">-</div>
                            <div class="stat-label">Simulated Win %</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val" id="simTotalGames" style="font-size: 1.3rem;">-</div>
                            <div class="stat-label">Simulated Avg Games</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DERIVED MARKETS -->
            <div class="card hidden" id="marketsArea" style="margin-top: 20px;">
                <div class="card-header" onclick="toggleCard('marketsArea')">
                    <h2>3. Derived Markets</h2>
                </div>
                <div class="card-content">
                    <h3>Match Winner (Fair Odds)</h3>
                    <div class="stat-grid" style="grid-template-columns: repeat(2, 1fr);">
                        <div class="stat-box">
                            <div class="stat-val prob-val" id="fairPlayer1">-</div>
                            <div class="stat-label">Player 1</div>
                        </div>
                        <div class="stat-box">
                            <div class="stat-val prob-val" id="fairPlayer2">-</div>
                            <div class="stat-label">Player 2</div>
                        </div>
                    </div>

                    <h3 style="margin-top: 20px;">Set Handicap</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Line</th>
                                <th class="num-col">Player 1</th>
                                <th class="num-col">Player 2</th>
                            </tr>
                        </thead>
                        <tbody id="setHandicapTable"></tbody>
                    </table>

                    <h3 style="margin-top: 20px;">Game Handicap</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Line</th>
                                <th class="num-col">Player 1</th>
                                <th class="num-col">Player 2</th>
                            </tr>
                        </thead>
                        <tbody id="gameHandicapTable"></tbody>
                    </table>

                    <h3 style="margin-top: 20px;">Total Games</h3>
                    <table>
                        <thead>
                            <tr>
                                <th>Line</th>
                                <th class="num-col">Over</th>
                                <th class="num-col">Under</th>
                            </tr>
                        </thead>
                        <tbody id="totalGamesTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- FIRST SET WINNER -->
            <div class="card hidden" id="firstSetArea" style="margin-top: 20px;">
                <div class="card-header" onclick="toggleCard('firstSetArea')">
                    <h2>4. First Set Winner</h2>
                </div>
                <div class="card-content">
                    <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">
                        Calculated using: P(First Set) = 1 / (1 + e^(-(3.25 Ã— P(Match) - 1.72)))
                    </p>
                    <table>
                        <thead>
                            <tr>
                                <th>Player</th>
                                <th class="num-col">Prob</th>
                                <th class="num-col">Odds</th>
                            </tr>
                        </thead>
                        <tbody id="firstSetWinnerTable"></tbody>
                    </table>
                </div>
            </div>

            <!-- CORRECT SCORE -->
            <div class="card hidden" id="exactScoreArea" style="margin-top: 20px;">
                <div class="card-header" onclick="toggleCard('exactScoreArea')">
                    <h2>5. Correct Score (Match)</h2>
                </div>
                <div class="card-content">
                    <p style="font-size: 0.85rem; color: #64748b; margin-bottom: 10px;">
                        Based on Monte Carlo simulation results
                    </p>
                    <table>
                        <thead>
                            <tr>
                                <th>Score</th>
                                <th class="num-col">Prob</th>
                                <th class="num-col">Odds</th>
                            </tr>
                        </thead>
                        <tbody id="correctScoreTable"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script>
        function toggleCard(id) {
            document.getElementById(id).classList.toggle('collapsed');
        }

        function toggleAllCards() {
            const cards = document.querySelectorAll('.card');
            const allCollapsed = [...cards].every(c => c.classList.contains('collapsed'));
            cards.forEach(c => c.classList.toggle('collapsed', !allCollapsed));
            document.getElementById('toggleAllBtn').textContent = allCollapsed ? 'Collapse All' : 'Expand All';
        }
    </script>
    <script type="module" src="tennis_model.js"></script>
</body>

</html>
